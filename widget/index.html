<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>add app root page</title>
    <link rel="stylesheet" type="text/css" href="./css/api.css" />
    <style type="text/css">
    </style>
</head>
<body>   
</body>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript">
apiready = function(){

    var cityList = fnGetCityList();

    var userInfo = $api.getStorage('userInfo');
    if (userInfo && userInfo.id) {
        api.openWin({
            name: 'main',
            url: './html/main.html',
            slidBackEnabled: false, //禁止ios滑动退出应用
            pageParam: {
                cityList_: cityList
            }
        });
    } else {
        api.openWin({
            
            name: 'login',
            url: './html/login.html',
            slidBackEnabled: false, //禁止ios滑动退出应用
            pageParam: {
                name: 'add'
            }
        }); 
    }    
};

function fnGetCityList() {
    var params = {  //根据文档构造参数
        fields: {},  //设置过虑的数据库字段如：code:false;
        where: {},   //过虑条件
        skip: 0,   //页数
        limit: 20  //城市数量
    }
    params = $api.jsonToStr(params);  //对象转换成json
    //获取数据请求
    api.ajax({
        url: 'http://d.apicloud.com/mcm/api/city?filter=' + params,
        method: 'get',
        headers: {
            "X-APICloud-AppId": "A6084933293707",
            "X-APICloud-AppKey": '9f32f538e1089612d96d995af828f65b66978edd.1539670980833'
        }        
    },function(ret, err){
        if (ret) {
            //ret做为参数，返回给一个func
            console.log($api.jsonToStr(ret));  //console.log不能直接输出对象,需要转化为str
            return ret
        } else {
            console.log($api.jsonToStr(err))
            alert( JSON.stringify( err ) );
        }
    });
}
</script>
</html>