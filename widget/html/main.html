<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>main</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
	<style>
		header {
			display: block;   /*块级元素*/
			position: relative;  /*位置*/
			width: 100%;
			height: 50px;  
			background-color: #C71585;
		}
        header .left {
            position: absolute;
            z-index: 2;
            left: 0px;
            bottom: 0px;
            width: 90px;
            height: 50px;
        }
        header .left .arrow-down {
            position: absolute;
            top: 21px;
            left: 12px;
            width: 13px;
            height: 8px;
            background-image: url(../image/arrow_down.png);
            background-size: 13px 8px;
            -webkit-transition: all 200ms;
            transition: all 200ms;
        }
        
        header .left .arrow-up {
            -webkit-transform: rotate(-180deg);
            transform: rotate(-180deg);
        }
        
        header .left .city-text {
            width: 100%;            
            box-sizing: border-box;
            height: 14px;
            padding-left: 28px;
            padding-top: 18px;
            line-height: 14px;
            font-size: 14px;
            text-align: left;
            color: #fff;
        }
		header .center {
			position: relative;  /*可变位置元素*/
			width: 100%;
			height: 50px;
			font-size: 30px; color: #fff; text-align:center; 
		}
		header .right{
			position: absolute;  /*固定位置元素*/
			bottom: 0;
			right: 0;
			width: 40px;
			height: 50px;
			background: url(../image/home_membercenter.png);
			background-size: 30px 30px;
			background-position: center center;
			background-repeat: no-repeat;
		}
        nav {
            /*通过以下三句display声明nav为弹性盒子元素*/
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: horizontal; /*盒子内元素排列为平行*/
            -webkit-flex-flow: row;  /*流式：即顺序排列*/
            flex-flow: row;
            position: relative;  /*非固定元素*/
            width: 100%;
            height: 40px;
            background-color: #C71585;
        }
        nav .menu{
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            width: 100%;
            height: 40px;
            font-size: 13px; color: #f973b8; text-align: center;
        }
        /*选中样式*/
        nav .menu.selected {
            font-size: 15px; color: #fff; font-weight: bolder;
        }
	</style>
</head>
<body>
	<header id="header">
        <div class="left" tapmode onclick="fnOpenCitySelectorFrame()">
            <div id="cityArrow" class="arrow-down"></div>
            <div id="cityText" class="city-text">广州</div>
        </div>
		<div class="center">app技术杂货铺</div>
		<div class="right" tapmode onclick="fnOpenPersonalCenter()"></div>
	</header>
    <nav id="nav">
        <div class="menu selected" tapmode="selected" onclick="fnSetNavMenuIndex(0);">加减法</div>
        <div class="menu" tapmode="selected" onclick="fnSetNavMenuIndex(1);">计时测试</div>
        <div class="menu" tapmode="selected" onclick="fnSetNavMenuIndex(2);">英语</div>
        <div class="menu" tapmode="selected" onclick="fnSetNavMenuIndex(3);">商城</div>
        <div class='menu' tapmode="selected" onclick="fnSetNavMenuIndex(4);">资讯</div>
    </nav>
</body>

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
apiready = function(){

    fnInitEventListenner();  //初始化事件监听器（监听退出）
    //变量
    var header = $api.byId("header");  //使用id获取变量值
    var nav =$api.byId('nav');
    $api.fixStatusBar(header);  //使用沉浸式（消除状顶部态栏-）
    var navH = $api.offset(nav).h;
    //全局变量
    headerH = $api.offset(header).h;  //获取header的高度
    menus = $api.domAll(nav, '.menu'); //dom元素选择器; arg1: 父元素 arg2: 选择器
    
    //循环生成frames列表 
    var frameList = [];  //列表类型  
    for (var i=0; i<menus.length; i++) {
        frameList.push({
            name: 'main_frame_' + i,
            url: './main_frame_'+ i +'.html',
        });
    }

    //打开frame组
    api.openFrameGroup ({
        name: 'mainFrameGroup',
        //background: '#fff',
        scrollEnabled: true,   //左右滑动frame页面
        rect: {
             x: 0, 
             y: headerH + navH, 
             w: 'auto', 
             h: 'auto'
        },
        index: 0,  //默认打开第x frame页面
        frames: frameList//调用列表变量
    }, function(ret, err){
        if( ret ){
             //ret={"index":1, "name":"frame2"}
             fnSetNavMenuSelected(ret.index);
        }
    });
}

//点击菜单切换frame
function fnSetNavMenuIndex(index_) {
    fnSetNavMenuSelected(index_);  //提前调用滑动的fn 达到优化点击的效果
    api.setFrameGroupIndex({
        name: 'mainFrameGroup',
        index: index_,
        scroll: true
    });
}

//滑动选择切换frame
var menus;  //调用全局变量
function fnSetNavMenuSelected(index_) {
    for(var i=0; i<menus.length; i++) {
        //判断传入的index_是否等于i
        if (index_ == i) {
            $api.addCls(menus[i], 'selected');
        } else {
            $api.removeCls(menus[i], 'selected');
        }
    }
}

var headerH;
function fnOpenCitySelectorFrame() {
    api.openFrame({
        name: 'cityselector_frame',
        url: './cityselector_frame.html',
        rect: {
            x: 0,
            y: headerH,
            w: 'auto',
            h: 'auto'
        },
        pageParam: {
            name: 'value'
        },
        bounces: true
    });
    $api.addCls($api.byId('cityArrow'), 'arrow-up');  //修改前头样式
}

//初始化系统监听器
function fnInitEventListenner() {
    //监听退出事件
    api.addEventListener({
        name: 'keyback'
    }, function(ret, err) {
        api.confirm({
            title: '提示',
            msg: '是否退出？',
            buttons: ['确定', '取消']
        }, function(ret, err) {
            if (ret.buttonIndex == 1) {
                api.closeWidget();  //关闭应用
            }
        });
    });
}

//打开个人中心
function fnOpenPersonalCenter() {
	api.openWin({
        name: 'personalcenter',
        url: './personalcenter.html',
        pageParam: {
            name: 'value'
        }
    });
}
    
</script>
</html>